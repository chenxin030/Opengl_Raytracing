# OpenGL 实时光线追踪渲染器

一个基于现代OpenGL（4.3+）构建的实时光线追踪渲染器，支持动态场景编辑和实时交互。使用计算着色器进行光线追踪计算，集成ImGui实现可视化参数控制。

# OpenGL光线追踪前向渲染管线阶段性总结

## 📦 核心功能概览
- **PBR材质** | **Bloom效果** | **PCF/PCSS阴影**  
- **SSAO环境光遮蔽** | **Skybox天空盒** | **TAA时间抗锯齿**  
- **3种光源**（点光/定向光/区域光） | **2种几何体**（球体/平面）
- **WASD + 鼠标右键控制摄像机**
- **实时帧率显示（带颜色状态指示）**
- **场景物体实时编辑（位置/颜色/尺寸）**
- **SSBO（着色器存储缓冲对象）数据传输**

---

## 🛠 功能实现细节

### 1. 渲染管线流程
```plaintext
1. 光线追踪计算 → 2. SSAO环境遮蔽 → 3. Bloom高光处理 → 4. TAA抗锯齿 → 5. 最终合成
```

---

### 2. 核心模块解析

#### 📌 **光线追踪引擎**
- **实现文件**: `raytracingCs.glsl`
- **关键技术**:
  - **光线生成**: 根据相机参数生成初始光线，支持抖动采样（Jittering）
  - **求交算法**:
    - *球体*: 解二次方程检测交点（`intersectSphere`）
    - *平面*: 使用法向量与平面方程计算交点（`intersectPlane`）
  - **加速结构**: 通过AABB包围盒进行初步剔除（`intersectAABB`）
  - **递归限制**: 最大深度`MAX_RAY_DEPTH=1`，能量衰减控制光线终止

#### 📌 **PBR材质系统**
- **实现文件**: `raytracingCs.glsl`
- **计算模型**:
  - **BRDF组成**:
    - 法线分布（GGX NDF）
    - 几何遮蔽（Schlick-GGX G）
    - 菲涅尔反射（Schlick近似）
  - **能量守恒**: 漫反射(`kD`)与镜面反射(`F`)动态分配
  - **折射处理**: 根据Snell定律计算折射方向，支持全内反射

#### 📌 **光源系统**
- **光源类型**:
  - **点光源**: 球状衰减（`1/d²`）
  - **定向光**: 无限远平行光
  - **区域光**: 圆盘采样（余弦加权+PDF计算）
- **阴影技术**:
  - **PCF**: 多采样软化阴影边缘（`pcfShadow`）
  - **PCSS**: 动态半影调节（`pcssShadow`）
  - **区域光支持**: 基于光源半径的软阴影计算

#### 📌 **Bloom效果**
- **管线阶段**: 后处理阶段
- **实现流程**:
  1. **高亮提取**: 亮度阈值过滤（`brightness_extractFs.glsl`）
  2. **高斯模糊**: 双通道分离式模糊（水平+垂直，`gaussian_blurFs.glsl`）
  3. **合成叠加**: 原图与模糊图加权混合（`bloom_combineFs.glsl`）

#### 📌 **SSAO环境光遮蔽**
- **实现文件**: `ssaoFs.glsl` + `ssao_blurFs.glsl`
- **关键技术**:
  - **半球采样**: 64个随机采样点（TBN空间转换）
  - **深度测试**: 屏幕空间深度对比+范围检查
  - **后处理模糊**: 高斯模糊降噪（5x5卷积核）

#### 📌 **TAA时间抗锯齿**
- **实现文件**: `taaFs.glsl`
- **核心算法**:
  - **历史帧混合**: 使用AABB裁剪消除鬼影（`clipAABB`）
  - **抖动采样**: Halton序列生成子像素偏移
  - **动态混合因子**: 可调节的历史帧权重（`uBlendFactor`）

#### 📌 **天空盒系统**
- **实现方式**:
  - HDR环境图转立方体贴图（`ConvertHDRToCubemap`）
  - 光线未命中物体时采样天空盒（`skybox`采样器）
- **优化点**: Mipmap生成与三线性过滤

---

### 3. 性能优化
- **计算着色器**: 32x32工作组尺寸（`raytracingCs.glsl`）
- **俄罗斯轮盘赌**: 深度>3时概率终止光线
- **资源绑定**:
  - 使用SSBO存储场景物体/光源数据
  - G-Buffer分离存储位置/法线信息（`gPositionTex`/`gNormalTex`）

---

### 4. 扩展能力
- **动态加载系统**:
  - 支持实时添加/删除物体光源（`SSBO`）
  - ImGUI参数调节（阴影质量/抗锯齿强度等）
- **跨格式支持**:
  - HDR环境图（`.hdr`）
  - 多分辨率适配（动态Viewport）

### 5. RenderDoc使用经历
- 通过SSBO传数据时，查看CS的Read/Write Bindings看到数据对齐出现问题。
- 切换skybox时，天空盒效果消失，切换回默认天空盒也是全黑，可以在CS的Textures的Slot看到我激活的纹理插槽错误。